# 🐍 Python `re` 正则表达式 



`re` 模块是 Python 中用于处理正则表达式的标准库。正则表达式是一种“迷你语言”，用于在文本中查找、匹配和操作符合特定“模式”的字符串。



## 1. 🚨 核心规则：`r"..."` 原始字符串



在 Python 中定义正则表达式模式时，**永远**在字符串前加上 `r`。

- **原因：** `r` (Raw String) 会告诉 Python 不要转义字符串中的 `\`。
- **对比：**
  - **标准字符串：** `"\\d"` (你需要输入两个 `\` 才能表示一个 `\`)
  - **原始字符串：** `r"\d"` (你输入的就是你想要的)



## 2. 🚀 `re` 模块核心流程



1. **导入：** `import re`
2. **定义模式 (Pattern)：** `pattern = r"你的规则"`
3. **定义文本 (Text)：** `text = "你要搜索的文本"`
4. **执行匹配 (Match)：** `match = re.search(pattern, text)`
5. **检查结果 (Check)：** **必须**用 `if` 来检查，因为匹配失败会返回 `None`。

Python

```
import re

pattern = r"hello (\w+)" # 规则：hello 后面跟一个单词
text = "Well, hello python"

match = re.search(pattern, text)

if match:
    print("匹配成功！")
    # 'match' 是一个 Match 对象
    print(f"完整匹配: {match.group(0)}")
    print(f"第1捕获组: {match.group(1)}")
else:
    print("匹配失败。")
```



## 3. 🛠️ `re` 模块四大核心函数



| **函数**           | **功能**                                                 | **返回值**             |
| ------------------ | -------------------------------------------------------- | ---------------------- |
| `re.search(p, t)`  | 在**整个**文本 `t` 中搜索**第一个** `p` 匹配。           | `Match` 对象 或 `None` |
| `re.findall(p, t)` | 在**整个**文本 `t` 中搜索**所有** `p` 匹配。             | `list` (列表)          |
| `re.sub(p, r, t)`  | **替换** (Substitute)：在 `t` 中查找 `p`，并替换为 `r`。 | `str` (新字符串)       |
| `re.match(p, t)`   | **只在**文本 `t` 的**开头**匹配 `p`。                    | `Match` 对象 或 `None` |

**`re.findall` 的特别说明：**

- **无捕获组 `( )`：** `re.findall(r"\d+", "12 34")` → `['12', '34']` (返回所有完整匹配)
- **有捕获组 `( )`：** `re.findall(r"(\w+):(\d+)", "a:1 b:2")` → `[('a', '1'), ('b', '2')]` (**只**返回捕获组内容的元组列表)



## 4. 🎁 `Match` 对象：匹配成功后



当 `re.search()` 或 `re.match()` 成功时，你会得到一个 `Match` 对象。

| **方法**         | **描述**                                                 | **示例 r"User: (Alice)"** |
| ---------------- | -------------------------------------------------------- | ------------------------- |
| `if match:`      | **必须的检查**，因为失败时 `match` 为 `None`             |                           |
| `match.group(0)` | 返回**完整**的匹配字符串                                 | `"User: Alice"`           |
| `match.group(1)` | 返回第 **1** 个 `()` 捕获组的内容                        | `"Alice"`                 |
| `match.group(n)` | 返回第 `n` 个 `()` 捕获组的内容                          |                           |
| `match.groups()` | 以**元组**形式返回所有捕获组 `(group(1), group(2), ...)` | `("Alice",)`              |
| `match.start()`  | 匹配的起始索引                                           | `0` (假设从头开始)        |
| `match.end()`    | 匹配的结束索引                                           | `11`                      |



## 5. 📖 元字符速查 (迷你语言)





### a. 常用字符



| **符号** | **含义**                                              |
| -------- | ----------------------------------------------------- |
| `.`      | 匹配**任意单个字符** (除了换行符 `\n`)                |
| `\d`     | 匹配**一个数字** (Digit) [0-9]                        |
| `\w`     | 匹配**一个单词字符** (Word) [a-zA-Z0-9_]              |
| `\s`     | 匹配**一个空白字符** (Space) [空格, `\t`, `\n`, `\r`] |
| `\D`     | **非**-数字                                           |
| `\W`     | **非**-单词字符                                       |
| `\S`     | **非**-空白字符                                       |



### b. 量词 (指定数量)



(量词总是放在它要修饰的字符 *后面*)

| **符号** | **含义**                 | **示例 r"..."**                      |
| -------- | ------------------------ | ------------------------------------ |
| `+`      | 匹配 **1 次**或**多次**  | `\d+` (匹配 "1", "123")              |
| `*`      | 匹配 **0 次**或**多次**  | `\d*` (匹配 "", "1", "123")          |
| `?`      | 匹配 **0 次**或 **1 次** | `colou?r` (匹配 "color", "colour")   |
| `{n}`    | 恰好 `n` 次              | `\d{3}` (只匹配 "123")               |
| `{n,}`   | **至少** `n` 次          | `\d{2,}` (匹配 "12", "123456")       |
| `{n,m}`  | **n 到 m** 次            | `\d{2,4}` (匹配 "12", "123", "1234") |



### c. 锚点 (指定位置)



| **符号** | **含义**                                                     |
| -------- | ------------------------------------------------------------ |
| `^`      | 匹配字符串的**开头**                                         |
| `$`      | 匹配字符串的**结尾**                                         |
| `\b`     | 匹配**单词边界** (例如 `r"\bword\b"` 会匹配 "word" 但不匹配 "sword") |
| `\A`     | 仅匹配字符串开头 (同 `^`)                                    |
| `\Z`     | 仅匹配字符串结尾 (同 `$`)                                    |



### d. 分组与集合



| **符号**  | **含义**                                    | **示例 r"..."**                     |
| --------- | ------------------------------------------- | ----------------------------------- |
| `[ ]`     | **字符集**：匹配 `[]` 中的**任一**字符      | `r"[abc]"` (匹配 "a" 或 "b" 或 "c") |
| `[a-z]`   | **范围**：匹配范围内的任一字符              | `r"[a-z0-9]"` (任一小写字母或数字)  |
| `[^ ]`    | **排除集**：匹配**非** `[]` 中的任一字符    | `r"[^0-9]"` (非数字, 等同 `\D`)     |
| `( )`     | **捕获组**：用于提取数据 (group 1, 2...)    | `r"User: (\w+)"`                    |
| `|`       | **或 (OR)**：匹配 `                         | ` 任意一边的表达式                  |
| `(?:...)` | **非捕获组**：只分组，不捕获 (不计入 group) | `r"(?:http|https)"`                 |



## 6. 🧠 进阶：贪婪 (Greedy) vs. 懒惰 (Lazy)



默认情况下，量词 `*`、`+` 和 `{}` 都是**贪婪的**，它们会“尽可能多”地匹配文本。

- **问题：** `text = "<a>b</a>c<a>d</a>"`，你用 `r"<a>.*</a>"` 匹配。
- **贪婪 `\*` (默认)：** 会匹配 `<a>b</a>c<a>d</a>` (它从第一个 `<a>` 一直匹配到 *最后* 一个 `</a>`)。

**解决方案：** 在量词后加一个 `?`，使其变为**懒惰模式**，它会“尽可能少”地匹配。

- **懒惰 `\*?`：** `r"<a>.*?</a>"`
- **匹配：** 会先匹配 `<a>b</a>`，如果继续搜索，会再匹配 `<a>d</a>`。

| **模式** | **含义**             |
| -------- | -------------------- |
| `*?`     | 懒惰的 "0 次或多次"  |
| `+?`     | 懒惰的 "1 次或多次"  |
| `??`     | 懒惰的 "0 次或 1 次" |
| `{n,m}?` | 懒惰的 "n 到 m 次"   |

------

**最佳实践建议：**

- **使用 [Regex101.com](https://regex101.com/)**：这是一个神器。你可以在线测试你的正则表达式，它会给你详细的解释。
- **`re.compile()`**：如果一个正则表达式你要在循环中用很多次，可以先 `pattern = re.compile(r"...")` 编译它，然后 `pattern.search(text)`，这样效率更高。
- **`re.IGNORECASE`**：`re.search(r"a", "A", re.IGNORECASE)`，忽略大小写。