# 📝 Python 列表推导式 (List Comprehension) 速查笔记



列表推导式是 Python 中一种优雅且高效的语法，用于**根据现有的可迭代对象（如列表、元组、range等）创建新列表**。它将 `for` 循环、`append` 操作（以及可选的 `if` 判断）压缩到一行代码中。



## 1. 核心语法





### a. 基础形式 (等同于 `for...append`)



**目的：** 对可迭代对象中的每个元素执行一个“表达式”，并将结果收集到新列表中。

语法模板：

[expression for item in iterable]

**阅读方法：** “**对于** `iterable` **中的每一个** `item`，**我要** `expression`。”

**示例：**

- **传统 `for` 循环：**

  Python

  ```
  squares = []
  for x in range(10):
      squares.append(x * x)
  # squares -> [0, 1, 4, ..., 81]
  ```

- **列表推导式：**

  Python

  ```
  squares = [x * x for x in range(10)]
  # squares -> [0, 1, 4, ..., 81]
  ```



### b. 带 `if` 筛选 (等同于 `for...if...append`)



**目的：** 只对可迭代对象中**满足 `if` 条件**的元素执行表达式。

语法模板：

[expression for item in iterable if condition]

(注意：if 语句在 for 循环的 后面)

**阅读方法：** “**对于** `iterable` **中的每一个** `item`，**当** `condition` **为真时**，**我要** `expression`。”

**示例：**

- **传统 `for` 循环：** (只获取偶数的平方)

  Python

  ```
  even_squares = []
  for x in range(10):
      if x % 2 == 0:
          even_squares.append(x * x)
  # even_squares -> [0, 4, 16, 36, 64]
  ```

- **列表推导式：**

  Python

  ```
  even_squares = [x * x for x in range(10) if x % 2 == 0]
  # even_squares -> [0, 4, 16, 36, 64]
  ```



### c. 带 `if-else` 分支 (等同于 `for...if...else...append`)



**目的：** **所有**元素都要处理，但根据条件执行**不同**的表达式（二选一）。

语法模板：

[expr_if_true if condition else expr_if_false for item in iterable]

(注意：if-else 三元运算符在 for 循环的 前面，作为 expression 的一部分)

**阅读方法：** “**我要** `expr_if_true`（**如果** `condition` **为真**）**否则** `expr_if_false`，**对于** `iterable` **中的每一个** `item`。”

**示例：**

- **传统 `for` 循环：** (标记奇数和偶数)

  Python

  ```
  labels = []
  for x in range(10):
      if x % 2 == 0:
          labels.append("Even")
      else:
          labels.append("Odd")
  # labels -> ['Even', 'Odd', 'Even', ...]
  ```

- **列表推导式：**

  Python

  ```
  labels = ["Even" if x % 2 == 0 else "Odd" for x in range(10)]
  # labels -> ['Even', 'Odd', 'Even', ...]
  ```



### d. 嵌套 `for` 循环 (等同于嵌套 `for` 循环)



**目的：** 处理嵌套的列表（例如，将矩阵“展平”）。

语法模板：

[expression for outer_item in outer_iterable for inner_item in inner_iterable]

(注意：for 循环的顺序与传统写法完全一致)

**示例：**

- **传统 `for` 循环：** (展平矩阵)

  Python

  ```
  matrix = [[1, 2], [3, 4]]
  flat_list = []
  for row in matrix:
      for item in row:
          flat_list.append(item)
  # flat_list -> [1, 2, 3, 4]
  ```

- **列表推导式：**

  Python

  ```
  matrix = [[1, 2], [3, 4]]
  flat_list = [item for row in matrix for item in row]
  # flat_list -> [1, 2, 3, 4]
  ```



## 2. 语法速查表



| **目的**           | **语法 (模板)**                                              |
| ------------------ | ------------------------------------------------------------ |
| **基础映射**       | `[expr for item in iterable]`                                |
| **筛选 (Filter)**  | `[expr for item in iterable if condition]`                   |
| **分支 (Ternary)** | `[expr_if if condition else expr_else for item in iterable]` |
| **嵌套循环**       | `[expr for outer in iterable1 for inner in iterable2]`       |
| **全功能**         | `[expr_if if cond1 else expr_else for item in iterable if cond2]` |



## 3. 为什么使用列表推导式？



- **✅ 简洁 (Concise)：** 一行代码代替 3-5 行。
- **✅ 可读 (Readable)：** 一旦熟悉，它比 `map()` 和 `filter()` 函数更直观。
- **✅ 高效 (Efficient)：** Python 内部会对其进行优化，通常比手写的 `for...append` 循环**更快**。

> ⚠️ 最佳实践：
>
> 如果推导式变得过于复杂（例如，超过两层嵌套或 if-else 逻辑太长），为了代码的可读性，请退回到使用标准的 for 循环。



## 4. 相关“兄弟”语法



使用几乎完全相同的语法，你也可以创建**集合 (Set)** 和**字典 (Dictionary)**：

- **集合推导式 (Set Comprehension)：**
  - **目的：** 创建集合（自动去重）。
  - **语法：** 使用花括号 `{}`。
  - **示例：** `squares_set = {x * x for x in [1, 1, 2, 2]}` → `{1, 4}`
- **字典推导式 (Dictionary Comprehension)：**
  - **目的：** 创建字典。
  - **语法：** 使用花括号 `{}` 和 `key: value` 对。
  - **示例：** `squares_dict = {x: x * x for x in range(5)}` → `{0: 0, 1: 1, 2: 4, 3: 9, 4: 16}`

