# pkmninsh

## 玩法

玩法上，和 task3 的要求没有机制上的不同，可能实现细节略有不同

最显著的差别是，一方只能选择一个 creature 出场（没有处理成队）

然后加入了一个 α 一个 ω，文末已附细表

### Quick Start

```bash
python -m pkmninsh.adapters.cli
```

## 设计理念

因为很早之前被某个叫——三国某，三某杀，某国杀——的游戏虐身虐心，又想和朋友愉快的 play，没有找到别人重构好的版本，所以就有自己实现一个的想法，又恰好遇到了这个作业，于是乎，就诞生了这么复杂的一个结构，算是一次练手

### 目录结构



### 部分数据驱动

使用 yaml 定义了包括 creature、move 和 status 在内的大量游戏内容

简单的数值修改不需要直接编写代码

也针对复杂需求提供了 passives.py（好像成了万能入口了...） 和 steps.py（Step Provider）

#### 缺陷

因为一开始的设计缺少考虑，现在 passives.py 包括了 StatusHandler 和 passives

本来考虑增加 Effect Provider （甚至 DSL），但是后来发现工作量有点大，以及现有结构已经有混乱的迹象了，便放弃了

### Action Pipeline &&  Assembler

每一次动作均由 Assembler 装配的 Action Pipeline 通过 Action Context 的流转完成，通过 Step Provider 可以调整 Action Pipeline 的流程

### Effect

通过 effect 字段实现了 moves 的无代码修改；每个 effect 会通过 effect_registry 中注册的 Effect Handler 具体处理

#### 缺陷

目前只有 moves 支持了 effect 字段，因为 passives 和 status 与 moves 具有一定的相似性，理论上也能复用 effect 字段；但我不确定会不会导致 Effect 膨胀成一个非常诡异的 DSL，与最初的目的南辕北辙，便放弃了这个想法；有不少 Handler 实现很粗糙，因为设计之初有很多问题没有考虑，都是在写 pokelike 的时候临时增加的

### Ops

一个用来调整战斗状态的窗口，提供对状态变化更好的控制，包括发送 OpsEvent 等，但因为是后来加的，所以我不确定是不是所有东西都通过了 Ops

### Core && Session && Adapters

通过 core 和 session，稍稍封装了一下游戏核心逻辑，不过因为各种原因吧，一定程度上造成了和现有 adapters 的耦合，总之就是，拆不开（

### Event

这个没啥好介绍的，就是一个简单的事件实现

### other

还有其他一些杂七杂八的东西，感觉没写得了（？

主要就是 plugin_loader 实现异常粗糙，以及作为一个独立的 cli 脚本恐怕需要额外包装，或者改一下目前的插件加载方案

## 插件内容

### 1. 皮卡丘（Pikachu）

| 属性   | 值                |
| ---- | ---------------- |
| 类型   | 电                |
| HP   | 80               |
| 攻击   | 35               |
| 防御   | 5                |
| 闪避率  | 30%              |
| 属性被动 | 成功闪避时立即行动（实现略简化） |

**技能：**

- **十万伏特（Thunderbolt）**\
  1.4 倍电属性伤害 + 约 10% 麻痹概率（实现一致）

- **电光一闪（Quick Attack）**\
  1.0 倍伤害 + 额外攻击概率 10%

---

### 2. 妙蛙种子（Bulbasaur）

| 属性   | 值                |
| ---- | ---------------- |
| 类型   | 草                |
| HP   | 100              |
| 攻击   | 35               |
| 防御   | 10               |
| 闪避率  | 10%              |
| 属性被动 | 每回合回复最大 HP 的 10% |

**技能：**

- **种子炸弹（Seed Bomb）**\
  草属性伤害 + 15% 中毒（每回合扣 10% HP）

- **寄生种子（Parasitic Seeds）**\
  持续 3 回合，每回合吸取对手最大 HP 的 10%

---

### 3. 杰尼龟（Squirtle）

| 属性   | 值                               |
| ---- | ------------------------------- |
| 类型   | 水                               |
| HP   | 80                              |
| 攻击   | 25                              |
| 防御   | 20                              |
| 闪避率  | 20%                             |
| 属性被动 | **作业要求：50% 减免 30% 伤害 → 实现中未完成** |

**技能：**

- **水枪（Aqua Jet）**\
  140% 水属性伤害

- **护盾（Shield）**\
  下一次受伤减免 50%

---

### 4. 小火龙（Charmander）

| 属性   | 值                       |
| ---- | ----------------------- |
| 类型   | 火                       |
| HP   | 80                      |
| 攻击   | 35                      |
| 防御   | 15                      |
| 闪避率  | 10%                     |
| 属性被动 | 每造成一次伤害攻击力 +10%，最多叠 4 层 |

**技能：**

- **火花（Ember）**\
  100% 伤害 + 10% 烧伤（每回合扣 10 HP，持续 2 回合）

- **蓄能爆炎（Flame Charge）**
  - 需要蓄力 1 回合
  - 300% 火属性伤害
  - 80% 概率烧伤
  - 提高对手闪避率到 1.2 倍（我不确定 +0.2 会不会比 1 大所以这么实现了）
 
---

## 三、demo 插件宝可梦与技能

### 1. Alpha

| 属性  | 值   |
| --- | --- |
| 类型  | 中性  |
| HP  | 60  |
| 攻击  | 20  |
| 防御  | 4   |
| 闪避率 | 10% |

技能：

- **打击（Strike）**：普通攻击（100% 命中，1 倍伤害）

### 2. Omega

| 属性  | 值   |
| --- | --- |
| 类型  | 中性  |
| HP  | 120 |
| 攻击  | 40  |
| 防御  | 10  |
| 闪避率 | 15% |

技能：

- **打击（Strike）**
- **Omega Blast**
  - 2.5 倍攻击力
  - 命中率 90%
  - 25% 几率眩晕 1 回合（没有实际效果）

---

## 四、状态效果（来自 pokelike 插件）

| 状态                      | 效果                                     |
| ------------------------ | ---------------------------------------- |
| **麻痹（paralysis）**     | ~~如果可能的话，我会给它实际作用的~~           |
| **烧伤（burn）**          | 每回合固定扣 10 HP，持续 2 回合               |
| **中毒（poison）**        | 每回合扣最大生命的 10%，通常持续 3 回合         |
| **寄生种子（leech\_seed）** | 敌人扣血，我方回复                          |
| **护盾（shield）**        | 持续一次攻击，减伤                           |